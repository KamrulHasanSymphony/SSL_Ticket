@{
    // ViewBag.Title = "Pending Task";
    Layout = "_Layout";
}



@* <div class="sapcer4"></div> *@
<div class="container-fluid">
    <div class="row" style="margin-bottom:6px;">
        <div class="col-sm-12">
            <label for="AssigneeUserId">Assignee User</label>
            <div class="input-group">
                <input type="text" id="AssigneeUserId" name="AssigneeUserId" class="" placeholder="Select Assignee..." style="height:32px;" data-val-required="*" />
                <button id="srcBtn" type="button" class="btn btn-primary" style="height:33px; margin-left:34px;">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <span class="field-validation-valid" data-valmsg-for="AssigneeUserId" data-valmsg-replace="true"></span>
        </div>
    </div>
</div>



<div class="container-fluid" id="divGrid">
    <div class="row">
        <div class="card card-primary">
            <div class="card-header">
                <h3 class="card-title">All Pending Task Informations</h3>
            </div>
            <div id="kAllPendingTaskGrid">
            </div>
        </div>
    </div>

</div>
<script>

    $(document).ready(function () {

        var PendingTaskSummaryManager = {

            gridPendingTaskDataSource: function () {
                var gridDataSource = new kendo.data.DataSource({
                    type: "json",
                    serverPaging: true,
                    serverSorting: true,
                    serverFiltering: true,
                    allowUnsort: true,
                    autoSync: true,
                    batch: true,
                    pageSize: 10,
                    transport: {
                        read: {
                            url: "/Task/GetAllPendingTaskData",
                            type: "POST",
                            dataType: "json",
                            cache: false
                        },
                        parameterMap: function (options) {
                            if (options.filter && options.filter.filters) {
                                options.filter.filters.forEach(function (filter) {
                                    if (filter.field === "startDate") {
                                        filter.value = kendo.toString(filter.value, "yyyy-MM-dd");
                                    }
                                });
                            }
                            return options;
                        }

                    },
                    batch: true,
                    schema: {
                        data: "items",
                        total: "totalCount",
                        model: {
                            id: "taskId",
                            fields: {
                                startDate: { type: "date" }
                            }
                        }
                    }
                });
                return gridDataSource;
            }
        }

        $("#kAllPendingTaskGrid").kendoGrid({
            dataSource: PendingTaskSummaryManager.gridPendingTaskDataSource(),
            pageable: {
                refresh: true,
                serverPaging: true,
                serverFiltering: true,
                serverSorting: true,
                pageSizes: [10, 20, 50, "all"]
            },
            noRecords: true,
            messages: {
                noRecords: "No Record Found!"
            },
            scrollable: true,
            filterable: {
                extra: true,
                operators: {
                    string: {
                        startswith: "Starts with",
                        endswith: "Ends with",
                        contains: "Contains",
                        doesnotcontain: "Does not contain",
                        eq: "Is equal to",
                        neq: "Is not equal to",
                        gt: "Is greater then",
                        lt: "Is less then"
                    }
                }
            },
            //detailInit: detailInitProduct,
            sortable: true,
            resizable: true,
            reorderable: true,
            groupable: true,

            toolbar: ["excel", "pdf", "search"],
            excel: {
                fileName: "Task Excel.xlsx",
                filterable: true
            },
            search: {
                fields: ["taskCode", "taskTitle", "productName"]
            },
            columns: [

                {
                    title: "Action",
                    width: 80,
                    template: function (dataItem) {
                        console.log(dataItem);
                        return "<a class='btn btn-primary btn-sm mr-2 edit' title='Modify' href='/Task/Edit/" + dataItem.taskId + "'>" + "<i class='fas fa-pencil-alt'></i>" + "</a>";
                    }
                },
                {
                    field: "taskId", title: "ID", width: 150,hidden: true, sortable: true
                },
                {
                    field: "t_TicketId", title: "TicketId", width: 150, hidden: true, sortable: true
                },
                {
                    field: "companyId", title: "CompanyId", width: 150, hidden: true, sortable: true
                },
                {
                    field: "ticketCode", title: "Ticket Code", sortable: true, width: 220
                },
                {
                    field: "taskCode", title: "Task Code", sortable: true, width: 220
                },

                {
                    field: "taskTitle", title: "Title", sortable: true, width: 220
                },
                {
                    field: "productName", title: "Product", sortable: true, width: 220
                },
                {
                    field: "taskDescription", title: "Description", hidden: true, sortable: true, width: 220
                },

                {
                    field: "startDate", title: "Start Date", sortable: true, width: 200, template: '#= kendo.toString(kendo.parseDate(startDate), "yyyy-MM-dd") #', filterable: {
                        ui: "datepicker"
                    }
                },
                {
                    field: "startTime", title: "Start Time", sortable: true, width: 140
                },
                {
                    field: "workingTime", title: "Working Time", sortable: true, width: 140
                },
                {
                    field: "startedBy", title: "Started By", sortable: true, width: 250
                },
                {
                    field: "createdBy", title: "Created By", sortable: true, width: 250
                },
                {
                    field: "assigneeUserIds", title: "Assignee Users", sortable: true, width: 250
                },
                {
                    field: "requiredTime", title: "Required Time", hidden: true, sortable: true, width: 150
                }

            ],
            editable: false,
            selectable: "row",
            navigatable: true,
            columnMenu: true
        });

         var multiComboBox = $("#AssigneeUserId").kendoMultiColumnComboBox({
            dataTextField: "profileName",
            dataValueField: "logId",
            height: 400,
            columns: [
                { field: "logId", title: "logId", width: 200 },
                { field: "profileName", title: "Profile", width: 200 }
            ],

            filter: "contains",
            filterFields: ["logId"],
            dataSource: {
                transport: {
                    read: "/Ticket/GetAllStackHolder"
                }
            }
        }).data("kendoMultiColumnComboBox");

        $("#srcBtn").click(function () {
        var assignee = $("#AssigneeUserId").data("kendoMultiColumnComboBox").value();
        debugger;
        // Rebuild the grid with new DataSource
        var grid = $("#kAllPendingTaskGrid").data("kendoGrid");

        grid.setDataSource(new kendo.data.DataSource({
            type: "json",
            serverPaging: true,
            serverSorting: true,
            serverFiltering: true,
            allowUnsort: true,
            autoSync: true,
            batch: true,
            pageSize: 10,
            transport: {
                read: {
                    url: "/Task/GetAllPendingTaskData",
                    type: "POST",
                    dataType: "json",
                    cache: false,
                    data: {
                        assigneeUserId: assignee || null
                    }
                },
                parameterMap: function (options) {
                    if (options.filter && options.filter.filters) {
                        options.filter.filters.forEach(function (filter) {
                            if (filter.field === "startDate") {
                                filter.value = kendo.toString(filter.value, "yyyy-MM-dd");
                            }
                        });
                    }
                    return options;
                }
            },
            schema: {
                data: "items",
                total: "totalCount",
                model: {
                    id: "taskId",
                    fields: {
                        startDate: { type: "date" }
                    }
                }
            }
        }));
    });

    });
</script>


